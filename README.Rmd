---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# 0. ggnorthcarolina

## Installation

You can install the development version of ggnorthcarolina from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("EvaMaeRey/ggnorthcarolina")
```

## Example

This is a basic example which shows you how to solve a common problem of working with North Carolina county characteristics data, and wanting to map that data, but not having boundary files on hand or not wanting to think about their preparation.  

Here's some info about NC counties in a data frame; it has no boundary info.

```{r example}
library(tidyverse)
library(ggnorthcarolina)
northcarolina_flat %>% head()
```

With ggnorthcarolina, voila, choropleth!

```{r}
library(ggnorthcarolina)
library(ggplot2)
northcarolina_flat %>%
ggplot() +
  aes(fips = FIPS) +
  geom_county() ->
A

last_plot() + 
  aes(fill = BIR74) ->
B

library(patchwork)
A + B
```

By declaring the aesthetic fips, the geom_ function joins the flat file to boundary data and an SF layer is plotted. 

We also make labeling these polygons easy:

```{r}
northcarolina_flat %>%
ggplot() +
aes(fips = FIPS, 
    fill = SID74,
    label = paste0(NAME, "\n", SID74)) +
  geom_county() +
  geom_county_label(
    lineheight = .7,
    size = 2, 
    check_overlap= TRUE,
    color = "oldlace")
```

<!-- badges: start -->
<!-- badges: end -->

# 1. Using ggnorthcarolina as a package-building reference

The second-order goal of ggnorthcarolina is to serve as a model and template for other ggplot-based geography-specific convenience mapping packages. 

## A. Shape file pre-step

A prerequisite to embarking on the following journey is that you have geographic data that you'd like to connect up to a flat file for mapping with ggplot2. In our case, for convenience, we use nc.shp provided in the sf package.  You'll see that file read in as an sf object later with the following code:

```
st_read(system.file("shape/nc.shp", package="sf")) 
```

Now, let's look at the package contents.  

```{r}
fs::dir_tree(recurse = F)
```

If you've done any package building before the components will be familiar. However, to replicate the functionality for other geographic regions (i.e. changing out North Carolina), we'll need to examine the data-raw and R folders are where all the creative action happens.

```{r}
fs::dir_tree(path = "data-raw", recurse = F)
fs::dir_tree(path = "R", recurse = F)
```

# B Prepare reference datasets.

The functions that you create in the R folder will use data that is prepared in the ./data-raw/DATASET.R file.  Let's have a look at the contents of that file to get a sense of the preparation.  Functions in the {ggnc} package will help you prepare the reference data that is required.  Keep an eye out for `ggnc::create_geometries_reference()` and `ggnc::prepare_polygon_labeling_data()`.

ggnc is available on git hub as shown:

```{r eval=FALSE}
remotes::install_github("EvaMaeRey/ggnc")
```



## B.i dataset build ./data-raw/DATASET.R


```{r, code = readLines("./data-raw/DATASET.R"), eval=FALSE}


```

Here are a few rows of each dataset that's created

```{r}
nc_flat %>% head()
northcarolina_county_reference %>% head()
nc_county_centers %>% head()
```


## B.ii dataset documentation ./R/data.R

Now you'll also want to document that data in ./R/data.R as shown

```{r, code = readLines("./R/data.R"), eval=FALSE}


```

# B. Prepare functions for building polygons defined by ids

## ./R/geom.R

```{r, code = readLines("./R/geom_county.R"), eval=FALSE}

```

## ./R/stamp.R

```{r, code = readLines("./R/stamp_county.R"), eval=FALSE}

```

### Changing context

Here is a suggested preparation for a package for allowing for ggbrasilstates easy creation of brazilian state choropleth, reading in an sf states object from the geombr package.

```
brasil_state_sf <- geobr::read_state() %>%
  rename(state_code = code_state,
         state_abb = abbrev_state,
         state = name_state,
         region_code = code_region,
         region = name_region,
         geometry = geom)# year 2010
```         

Then a number of changes would need to be made to update the DATASET.R file, including object names.  Also notably there are quite a few columns that are ID columns compared to the North Carolina case. 

Find and change can be used for object name changes.

```
id_cols = c(county_name, fips) -> id_cols = c(state_code, state_abb, state, region_code, region)
county -> state
northcarolina -> brasil
```

## ./R/labels.R

```{r, code = readLines("./R/geom_county_labels.R"), eval=FALSE}

```

For ggbrasil in these files changes should be made:

```
County -> State
```

New examples should be crafted.
